"use strict";(()=>{var e={};e.id=873,e.ids=[873],e.modules={11185:e=>{e.exports=require("mongoose")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},99101:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>z,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>b,staticGenerationAsyncStorage:()=>h});var n={};r.r(n),r.d(n,{POST:()=>p});var a=r(73278),s=r(45002),i=r(54877),o=r(71309),c=r(1035),d=r(47861),l=r(16910),u=r(15110),m=r(84115);async function p(e){try{await (0,c.Z)();let t=await e.json(),r=u.TW.parse(t),n=await d.Z.findOne({email:r.email}).select("+password");if(!n||!await n.comparePassword(r.password))return o.NextResponse.json({error:"Invalid email or password"},{status:401});let a=(0,l.RA)({userId:n._id.toString(),email:n.email,role:n.role});return(0,m.cookies)().set("token",a,{httpOnly:!0,path:"/",maxAge:86400}),o.NextResponse.json({message:"Login successful",user:{id:n._id,name:n.name,email:n.email,role:n.role,isVerified:n.isVerified},token:a})}catch(e){if(console.error("Login error:",e),"ZodError"===e.name)return o.NextResponse.json({error:"Validation failed",details:e.errors},{status:400});return o.NextResponse.json({error:"Internal server error"},{status:500})}}let f=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"C:\\Users\\Shivam\\Desktop\\charity-donation-backend (1)\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:b}=f,y="/api/auth/login/route";function z(){return(0,i.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:h})}},16910:(e,t,r)=>{r.d(t,{RA:()=>i,Ym:()=>o});var n=r(67390),a=r.n(n);let s=process.env.JWT_SECRET;if(!s)throw Error("Please define the JWT_SECRET environment variable");function i(e){return a().sign(e,s,{expiresIn:"7d"})}async function o(e){try{let t=function(e){let t=e.headers.get("authorization");return t&&t.startsWith("Bearer ")?t.substring(7):null}(e);if(!t)return null;return a().verify(t,s)}catch(e){return null}}},1035:(e,t,r)=>{r.d(t,{Z:()=>o});var n=r(11185),a=r.n(n);let s=process.env.MONGODB_URI;if(!s)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let i=global.mongoose;i||(i=global.mongoose={conn:null,promise:null});let o=async function(){if(i.conn)return i.conn;i.promise||(i.promise=a().connect(s,{bufferCommands:!1}).then(e=>e));try{i.conn=await i.promise}catch(e){throw i.promise=null,e}return i.conn}},15110:(e,t,r)=>{r.d(t,{Dl:()=>l,K3:()=>d,TW:()=>s,Y0:()=>a,aR:()=>o,db:()=>c,gV:()=>i,hj:()=>u});var n=r(29628);let a=n.z.object({name:n.z.string().min(2,"Name must be at least 2 characters").max(50,"Name cannot exceed 50 characters"),email:n.z.string().email("Invalid email address"),password:n.z.string().min(6,"Password must be at least 6 characters"),phone:n.z.string().regex(/^\+?[\d\s-()]+$/,"Invalid phone number").optional()}),s=n.z.object({email:n.z.string().email("Invalid email address"),password:n.z.string().min(1,"Password is required")}),i=n.z.object({name:n.z.string().min(2).max(50).optional(),phone:n.z.string().regex(/^\+?[\d\s-()]+$/).optional(),address:n.z.object({street:n.z.string(),city:n.z.string(),state:n.z.string(),zipCode:n.z.string(),country:n.z.string()}).optional()}),o=n.z.object({name:n.z.string().min(2,"Name must be at least 2 characters").max(100,"Name cannot exceed 100 characters"),email:n.z.string().email("Invalid email address"),password:n.z.string().min(6,"Password must be at least 6 characters"),registrationNumber:n.z.string().min(1,"Registration number is required"),phone:n.z.string().regex(/^\+?[\d\s-()]+$/,"Invalid phone number"),website:n.z.string().url("Invalid website URL").optional(),description:n.z.string().min(10,"Description must be at least 10 characters").max(1e3,"Description cannot exceed 1000 characters"),mission:n.z.string().min(10,"Mission must be at least 10 characters").max(500,"Mission cannot exceed 500 characters"),vision:n.z.string().min(10,"Vision must be at least 10 characters").max(500,"Vision cannot exceed 500 characters"),category:n.z.enum(["Education","Healthcare","Environment","Poverty","Animal Welfare","Disaster Relief","Human Rights","Arts & Culture","Sports","Other"]),location:n.z.object({address:n.z.string().min(1,"Address is required"),city:n.z.string().min(1,"City is required"),state:n.z.string().min(1,"State is required"),country:n.z.string().min(1,"Country is required")}),bankDetails:n.z.object({accountName:n.z.string().min(1,"Account name is required"),accountNumber:n.z.string().min(1,"Account number is required"),bankName:n.z.string().min(1,"Bank name is required"),ifscCode:n.z.string().min(1,"IFSC code is required"),branch:n.z.string().min(1,"Branch is required")})}),c=n.z.object({email:n.z.string().email("Invalid email address"),password:n.z.string().min(1,"Password is required")}),d=n.z.object({charityId:n.z.string().min(1,"Charity ID is required"),amount:n.z.number().min(1,"Amount must be at least 1"),currency:n.z.enum(["USD","INR","EUR","GBP"]).default("USD"),paymentMethod:n.z.enum(["stripe","razorpay"]),isAnonymous:n.z.boolean().default(!1),message:n.z.string().max(500,"Message cannot exceed 500 characters").optional(),dedicatedTo:n.z.string().max(100,"Dedication cannot exceed 100 characters").optional()}),l=n.z.object({title:n.z.string().min(1,"Title is required").max(200,"Title cannot exceed 200 characters"),description:n.z.string().min(1,"Description is required").max(2e3,"Description cannot exceed 2000 characters"),reportPeriod:n.z.object({startDate:n.z.string().transform(e=>new Date(e)),endDate:n.z.string().transform(e=>new Date(e))}),totalFundsReceived:n.z.number().min(0,"Total funds received must be non-negative"),totalFundsUtilized:n.z.number().min(0,"Total funds utilized must be non-negative"),beneficiariesReached:n.z.number().min(0,"Beneficiaries reached must be non-negative"),projects:n.z.array(n.z.object({name:n.z.string().min(1,"Project name is required"),description:n.z.string().min(1,"Project description is required"),fundsAllocated:n.z.number().min(0,"Funds allocated must be non-negative"),fundsUtilized:n.z.number().min(0,"Funds utilized must be non-negative"),status:n.z.enum(["planned","ongoing","completed","cancelled"]),beneficiaries:n.z.number().min(0,"Beneficiaries must be non-negative"),outcomes:n.z.array(n.z.string())})),financialBreakdown:n.z.array(n.z.object({category:n.z.string().min(1,"Category is required"),amount:n.z.number().min(0,"Amount must be non-negative"),percentage:n.z.number().min(0).max(100,"Percentage must be between 0 and 100"),description:n.z.string().optional()}))}),u=n.z.object({page:n.z.string().transform(Number).default("1"),limit:n.z.string().transform(Number).default("10"),search:n.z.string().optional(),category:n.z.string().optional(),location:n.z.string().optional(),sortBy:n.z.enum(["name","createdAt","totalReceived","rating"]).default("createdAt"),sortOrder:n.z.enum(["asc","desc"]).default("desc")})},47861:(e,t,r)=>{r.d(t,{Z:()=>o});var n=r(11185),a=r.n(n),s=r(93981);let i=new n.Schema({name:{type:String,required:[!0,"Name is required"],trim:!0,maxlength:[50,"Name cannot exceed 50 characters"]},email:{type:String,required:[!0,"Email is required"],unique:!0,lowercase:!0,match:[/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,"Please enter a valid email"]},password:{type:String,required:[!0,"Password is required"],minlength:[6,"Password must be at least 6 characters"],select:!1},phone:{type:String,match:[/^\+?[\d\s-()]+$/,"Please enter a valid phone number"]},address:{street:String,city:String,state:String,zipCode:String,country:String},profileImage:String,isVerified:{type:Boolean,default:!1},role:{type:String,enum:["user","admin"],default:"user"},donationHistory:[{type:n.Schema.Types.ObjectId,ref:"Donation"}],totalDonated:{type:Number,default:0}},{timestamps:!0});i.pre("save",async function(e){if(!this.isModified("password"))return e();try{let t=await s.ZP.genSalt(12);this.password=await s.ZP.hash(this.password,t),e()}catch(t){e(t)}}),i.methods.comparePassword=async function(e){return s.ZP.compare(e,this.password)};let o=a().models.User||a().model("User",i)},90568:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"DraftMode",{enumerable:!0,get:function(){return s}});let n=r(45869),a=r(54869);class s{get isEnabled(){return this._provider.isEnabled}enable(){let e=n.staticGenerationAsyncStorage.getStore();return e&&(0,a.trackDynamicDataAccessed)(e,"draftMode().enable()"),this._provider.enable()}disable(){let e=n.staticGenerationAsyncStorage.getStore();return e&&(0,a.trackDynamicDataAccessed)(e,"draftMode().disable()"),this._provider.disable()}constructor(e){this._provider=e}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},84115:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{cookies:function(){return m},draftMode:function(){return p},headers:function(){return u}});let n=r(71576),a=r(38044),s=r(25911),i=r(72934),o=r(90568),c=r(54869),d=r(45869),l=r(54580);function u(){let e="headers",t=d.staticGenerationAsyncStorage.getStore();if(t){if(t.forceStatic)return a.HeadersAdapter.seal(new Headers({}));(0,c.trackDynamicDataAccessed)(t,e)}return(0,l.getExpectedRequestStore)(e).headers}function m(){let e="cookies",t=d.staticGenerationAsyncStorage.getStore();if(t){if(t.forceStatic)return n.RequestCookiesAdapter.seal(new s.RequestCookies(new Headers({})));(0,c.trackDynamicDataAccessed)(t,e)}let r=(0,l.getExpectedRequestStore)(e),a=i.actionAsyncStorage.getStore();return(null==a?void 0:a.isAction)||(null==a?void 0:a.isAppRoute)?r.mutableCookies:r.cookies}function p(){let e=(0,l.getExpectedRequestStore)("draftMode");return new o.DraftMode(e.draftMode)}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},38044:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{HeadersAdapter:function(){return s},ReadonlyHeadersError:function(){return a}});let n=r(54203);class a extends Error{constructor(){super("Headers cannot be modified. Read more: https://nextjs.org/docs/app/api-reference/functions/headers")}static callable(){throw new a}}class s extends Headers{constructor(e){super(),this.headers=new Proxy(e,{get(t,r,a){if("symbol"==typeof r)return n.ReflectAdapter.get(t,r,a);let s=r.toLowerCase(),i=Object.keys(e).find(e=>e.toLowerCase()===s);if(void 0!==i)return n.ReflectAdapter.get(t,i,a)},set(t,r,a,s){if("symbol"==typeof r)return n.ReflectAdapter.set(t,r,a,s);let i=r.toLowerCase(),o=Object.keys(e).find(e=>e.toLowerCase()===i);return n.ReflectAdapter.set(t,o??r,a,s)},has(t,r){if("symbol"==typeof r)return n.ReflectAdapter.has(t,r);let a=r.toLowerCase(),s=Object.keys(e).find(e=>e.toLowerCase()===a);return void 0!==s&&n.ReflectAdapter.has(t,s)},deleteProperty(t,r){if("symbol"==typeof r)return n.ReflectAdapter.deleteProperty(t,r);let a=r.toLowerCase(),s=Object.keys(e).find(e=>e.toLowerCase()===a);return void 0===s||n.ReflectAdapter.deleteProperty(t,s)}})}static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"append":case"delete":case"set":return a.callable;default:return n.ReflectAdapter.get(e,t,r)}}})}merge(e){return Array.isArray(e)?e.join(", "):e}static from(e){return e instanceof Headers?e:new s(e)}append(e,t){let r=this.headers[e];"string"==typeof r?this.headers[e]=[r,t]:Array.isArray(r)?r.push(t):this.headers[e]=t}delete(e){delete this.headers[e]}get(e){let t=this.headers[e];return void 0!==t?this.merge(t):null}has(e){return void 0!==this.headers[e]}set(e,t){this.headers[e]=t}forEach(e,t){for(let[r,n]of this.entries())e.call(t,n,r,this)}*entries(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase(),r=this.get(t);yield[t,r]}}*keys(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase();yield t}}*values(){for(let e of Object.keys(this.headers)){let t=this.get(e);yield t}}[Symbol.iterator](){return this.entries()}}},71576:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{MutableRequestCookiesAdapter:function(){return u},ReadonlyRequestCookiesError:function(){return i},RequestCookiesAdapter:function(){return o},appendMutableCookies:function(){return l},getModifiedCookieValues:function(){return d}});let n=r(25911),a=r(54203),s=r(45869);class i extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#cookiessetname-value-options")}static callable(){throw new i}}class o{static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"clear":case"delete":case"set":return i.callable;default:return a.ReflectAdapter.get(e,t,r)}}})}}let c=Symbol.for("next.mutated.cookies");function d(e){let t=e[c];return t&&Array.isArray(t)&&0!==t.length?t:[]}function l(e,t){let r=d(t);if(0===r.length)return!1;let a=new n.ResponseCookies(e),s=a.getAll();for(let e of r)a.set(e);for(let e of s)a.set(e);return!0}class u{static wrap(e,t){let r=new n.ResponseCookies(new Headers);for(let t of e.getAll())r.set(t);let i=[],o=new Set,d=()=>{let e=s.staticGenerationAsyncStorage.getStore();if(e&&(e.pathWasRevalidated=!0),i=r.getAll().filter(e=>o.has(e.name)),t){let e=[];for(let t of i){let r=new n.ResponseCookies(new Headers);r.set(t),e.push(r.toString())}t(e)}};return new Proxy(r,{get(e,t,r){switch(t){case c:return i;case"delete":return function(...t){o.add("string"==typeof t[0]?t[0]:t[0].name);try{e.delete(...t)}finally{d()}};case"set":return function(...t){o.add("string"==typeof t[0]?t[0]:t[0].name);try{return e.set(...t)}finally{d()}};default:return a.ReflectAdapter.get(e,t,r)}}})}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[379,833,981,390,628],()=>r(99101));module.exports=n})();